<script>
    var serviceWorker = navigator.serviceWorker;
    if ( serviceWorker ) {
        serviceWorkerRegistration( serviceWorker, {
            opt: {scope: "/"},
            url: "/service-worker.js",
        });
    }
    function serviceWorkerRegistration( serviceWorker, options ){
        if (!serviceWorker) {
            console.log(`Oh no! Your browser doesn't support a feature needed to run this app (navigator.serviceWorker). 
Try using a different browser.`);
            return;
        }
        serviceWorker.register(options.url, options.opt).then(function (reg) {
            reg.addEventListener("statechange", function(){
                debugMode && console.log({"reg active state": reg.active.state});
            });
            reg.addEventListener("updatefound", function(){
                debugMode && console.log("new service worker update found:");
                var newSWController = reg.installing;
                newSWController.addEventListener("statechange", function(){
                    debugMode && console.log({"new sw controller state": this.state});
                    if ( this.state === "activated") { 
                        // do something //
                    }
                });
            });
        //  Refresh to activate the worker.
        //  if (!reg.active) {
        //      location.reload(); 
        //      return;
        //  } 
        }).catch(function(err) { 
            console.error(err);
        });
    }
</script>
